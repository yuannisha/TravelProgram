{"version":3,"file":"comments.js","sources":["pages/spots/comments.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3BvdHMvY29tbWVudHMudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 排序选项 -->\r\n\t\t<view class=\"sort-bar\">\r\n\t\t\t<view \r\n\t\t\t\tclass=\"sort-item\" \r\n\t\t\t\t:class=\"{ active: sortBy === 'time' }\"\r\n\t\t\t\t@click=\"changeSortBy('time')\"\r\n\t\t\t>\r\n\t\t\t\t<text>最新</text>\r\n\t\t\t</view>\r\n\t\t\t<view \r\n\t\t\t\tclass=\"sort-item\" \r\n\t\t\t\t:class=\"{ active: sortBy === 'rating' }\"\r\n\t\t\t\t@click=\"changeSortBy('rating')\"\r\n\t\t\t>\r\n\t\t\t\t<text>评分最高</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 评论列表 -->\r\n\t\t<scroll-view \r\n\t\t\tclass=\"comment-list\" \r\n\t\t\tscroll-y \r\n\t\t\t@scrolltolower=\"loadMore\"\r\n\t\t\trefresher-enabled\r\n\t\t\t:refresher-triggered=\"refreshing\"\r\n\t\t\t@refresherrefresh=\"onRefresh\"\r\n\t\t>\r\n\t\t\t<view class=\"comment-item\" v-for=\"(item, index) in commentList\" :key=\"index\">\r\n\t\t\t\t<image class=\"avatar\" :src=\"item.user.avatar\" mode=\"aspectFill\"></image>\r\n\t\t\t\t<view class=\"content\">\r\n\t\t\t\t\t<view class=\"user-info\">\r\n\t\t\t\t\t\t<text class=\"username\">{{item.user.username}}</text>\r\n\t\t\t\t\t\t<text class=\"rating\">{{item.rating}}分</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<text class=\"comment-text\">{{item.content}}</text>\r\n\t\t\t\t\t<view class=\"image-list\" v-if=\"item.images && item.images.length > 0\">\r\n\t\t\t\t\t\t<image \r\n\t\t\t\t\t\t\tv-for=\"(img, imgIndex) in item.images\" \r\n\t\t\t\t\t\t\t:key=\"imgIndex\" \r\n\t\t\t\t\t\t\t:src=\"img\" \r\n\t\t\t\t\t\t\tmode=\"aspectFill\"\r\n\t\t\t\t\t\t\t@click=\"previewImage(item.images, imgIndex)\"\r\n\t\t\t\t\t\t></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<text class=\"date\">{{formatDate(item.create_date)}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 加载状态 -->\r\n\t\t\t<view class=\"loading\" v-if=\"loading\">\r\n\t\t\t\t<text>正在加载...</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"no-more\" v-if=\"noMore\">\r\n\t\t\t\t<text>没有更多评论了</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"empty\" v-if=\"commentList.length === 0 && !loading\">\r\n\t\t\t\t<text>暂无评论</text>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * 景点评论列表页\r\n * @description 显示景点的所有评论，支持按时间和评分排序\r\n */\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tspotId: '', // 景点ID\r\n            userId: '', // 用户ID\r\n\t\t\tcommentList: [], // 评论列表\r\n\t\t\tpage: 1, // 当前页码\r\n\t\t\tpageSize: 10, // 每页数量\r\n\t\t\tloading: false, // 加载状态\r\n\t\t\tnoMore: false, // 是否还有更多\r\n\t\t\trefreshing: false, // 刷新状态\r\n\t\t\tsortBy: 'time', // 排序方式：time-时间，rating-评分\r\n\t\t}\r\n\t},\r\n\tonLoad(options) {\r\n\t\tif (options.id) {\r\n\t\t\tthis.spotId = options.id    \r\n            this.userId = options.userId\r\n\t\t\tthis.getComments()\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '参数错误',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tuni.navigateBack()\r\n\t\t\t}, 1500)\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t// 获取评论列表\r\n\t\tasync getComments() {\r\n\t\t\tif (this.loading || (this.noMore && !this.refreshing)) return\r\n\t\t\tthis.loading = true\r\n\t\t\t\r\n\t\t\ttry {\r\n                console.log(\"userId\",this.userId)\r\n                console.log(\"spotId\",this.spotId)\r\n\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'get-comments',\r\n\t\t\t\t\tdata: {\r\n                        userId: this.userId,\r\n\t\t\t\t\t\tspotId: this.spotId,\r\n\t\t\t\t\t\tpage: this.page,\r\n\t\t\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\t\t\tsortBy: this.sortBy,\r\n\t\t\t\t\t\tsortOrder: this.sortBy === 'time' ? 'desc' : 'desc'\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\tconst { list, total } = res.result.data\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.refreshing) {\r\n\t\t\t\t\t\tthis.commentList = list\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.commentList = [...this.commentList, ...list]\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.noMore = this.commentList.length >= total\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.result.message || '获取评论失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('获取评论失败:', e)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '获取评论失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false\r\n\t\t\t\tif (this.refreshing) {\r\n\t\t\t\t\tthis.refreshing = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 加载更多\r\n\t\tloadMore() {\r\n\t\t\tif (!this.noMore) {\r\n\t\t\t\tthis.page++\r\n\t\t\t\tthis.getComments()\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 下拉刷新\r\n\t\tasync onRefresh() {\r\n\t\t\tthis.refreshing = true\r\n\t\t\tthis.page = 1\r\n\t\t\tthis.noMore = false\r\n\t\t\tawait this.getComments()\r\n\t\t},\r\n\t\t\r\n\t\t// 切换排序方式\r\n\t\tchangeSortBy(type) {\r\n\t\t\tif (this.sortBy === type) return\r\n\t\t\tthis.sortBy = type\r\n\t\t\tthis.page = 1\r\n\t\t\tthis.commentList = []\r\n\t\t\tthis.noMore = false\r\n\t\t\tthis.getComments()\r\n\t\t},\r\n\t\t\r\n\t\t// 预览图片\r\n\t\tpreviewImage(images, current) {\r\n\t\t\tuni.previewImage({\r\n\t\t\t\turls: images,\r\n\t\t\t\tcurrent: images[current]\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t// 格式化日期\r\n\t\tformatDate(date) {\r\n\t\t\tconst d = new Date(date)\r\n\t\t\treturn `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.container {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #f5f5f5;\r\n}\r\n\r\n.sort-bar {\r\n\tdisplay: flex;\r\n\tbackground-color: #fff;\r\n\tpadding: 20rpx 30rpx;\r\n\tborder-bottom: 1rpx solid #eee;\r\n\t\r\n\t.sort-item {\r\n\t\tmargin-right: 40rpx;\r\n\t\tpadding: 10rpx 0;\r\n\t\t\r\n\t\ttext {\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tcolor: #666;\r\n\t\t}\r\n\t\t\r\n\t\t&.active {\r\n\t\t\tposition: relative;\r\n\t\t\t\r\n\t\t\ttext {\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t&::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tbottom: 0;\r\n\t\t\t\tleft: 50%;\r\n\t\t\t\ttransform: translateX(-50%);\r\n\t\t\t\twidth: 40rpx;\r\n\t\t\t\theight: 4rpx;\r\n\t\t\t\tbackground-color: #007AFF;\r\n\t\t\t\tborder-radius: 2rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.comment-list {\r\n\theight: calc(100vh - 100rpx);\r\n\t\r\n\t.comment-item {\r\n\t\tdisplay: flex;\r\n\t\tpadding: 30rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tmargin-bottom: 2rpx;\r\n\t\t\r\n\t\t.avatar {\r\n\t\t\twidth: 80rpx;\r\n\t\t\theight: 80rpx;\r\n\t\t\tborder-radius: 50%;\r\n\t\t\tmargin-right: 20rpx;\r\n\t\t}\r\n\t\t\r\n\t\t.content {\r\n\t\t\tflex: 1;\r\n\t\t\t\r\n\t\t\t.user-info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t\r\n\t\t\t\t.username {\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.rating {\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: #ff9500;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.comment-text {\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #666;\r\n\t\t\t\tline-height: 1.5;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.image-list {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tmargin: 0 -10rpx;\r\n\t\t\t\t\r\n\t\t\t\timage {\r\n\t\t\t\t\twidth: 200rpx;\r\n\t\t\t\t\theight: 200rpx;\r\n\t\t\t\t\tmargin: 10rpx;\r\n\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.date {\r\n\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t\tmargin-top: 10rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.loading, .no-more, .empty {\r\n\tpadding: 30rpx;\r\n\ttext-align: center;\r\n\t\r\n\ttext {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n}\r\n</style> ","import MiniProgramPage from 'D:/programs2024to2025/ranjiangtaoprogram/first/TravelPlatformMiniProgram/pages/spots/comments.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}