{"version":3,"file":"spots.js","sources":["pages/spots/spots.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3BvdHMvc3BvdHMudnVl"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 搜索栏 -->\n\t\t<view class=\"search-box\">\n\t\t\t<view class=\"search-input\" @click=\"goToSearch\">\n\t\t\t\t<text class=\"iconfont icon-search\"></text>\n\t\t\t\t<text class=\"placeholder\">搜索景点/地点</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 分类标签 -->\n\t\t<scroll-view class=\"category-scroll\" scroll-x>\n\t\t\t<view class=\"category-list\">\n\t\t\t\t<view \n\t\t\t\t\tclass=\"category-item\" \n\t\t\t\t\t:class=\"{ active: currentCategory === item.id }\"\n\t\t\t\t\tv-for=\"(item, index) in categories\" \n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t@click=\"changeCategory(item.id)\"\n\t\t\t\t>\n\t\t\t\t\t{{item.name}}\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</scroll-view>\n\t\t\n\t\t<!-- 景点列表 -->\n\t\t<scroll-view \n\t\t\tclass=\"spot-scroll\" \n\t\t\tscroll-y \n\t\t\t@scrolltolower=\"loadMore\"\n\t\t\trefresher-enabled\n\t\t\t:refresher-triggered=\"isRefreshing\"\n\t\t\t@refresherrefresh=\"refresh\"\n\t\t>\n\t\t\t<view class=\"spot-list\">\n\t\t\t\t<view class=\"spot-item\" v-for=\"(item, index) in spotList\" :key=\"index\" @click=\"goToDetail(item.id)\">\n\t\t\t\t\t<image :src=\"item.imageUrl\" mode=\"aspectFill\"></image>\n\t\t\t\t\t<view class=\"info\">\n\t\t\t\t\t\t<view class=\"name-box flex justify-between\">\n\t\t\t\t\t\t\t<text class=\"name\">{{item.name}}</text>\n\t\t\t\t\t\t\t<text class=\"distance\" v-if=\"item.distance\">{{item.distance}}km</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"tag-list\">\n\t\t\t\t\t\t\t<text class=\"tag\" v-for=\"(tag, tagIndex) in item.tags\" :key=\"tagIndex\">{{tag}}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"bottom\">\n\t\t\t\t\t\t\t<view class=\"rating\">\n\t\t\t\t\t\t\t\t<text class=\"score\">{{item.rating}}分</text>\n\t\t\t\t\t\t\t\t<text class=\"comment\">({{item.commentCount}}点评)</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<text class=\"price\">¥{{item.price}}起</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<!-- 加载更多 -->\n\t\t\t<view class=\"loading\" v-if=\"loading\">\n\t\t\t\t<text>正在加载...</text>\n\t\t\t</view>\n\t\t\t<view class=\"no-more\" v-if=\"noMore\">\n\t\t\t\t<text>没有更多了</text>\n\t\t\t</view>\n\t\t</scroll-view>\n\t</view>\n</template>\n\n<script>\n/**\n * 景点列表页\n * @description 展示所有景点，支持分类筛选和下拉刷新\n */\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tcategories: [\n\t\t\t\t{ id: 0, name: '全部' },\n\t\t\t\t{ id: 1, name: '自然风光' },\n\t\t\t\t{ id: 2, name: '人文古迹' },\n\t\t\t\t{ id: 3, name: '特色美食' },\n\t\t\t\t{ id: 4, name: '主题乐园' }\n\t\t\t],\n\t\t\tcurrentCategory: 0,\n\t\t\tspotList: [],\n\t\t\tpage: 1,\n\t\t\tpageSize: 10,\n\t\t\tloading: false,\n\t\t\tnoMore: false,\n\t\t\tisRefreshing: false,\n\t\t\tlongitude: null,\n\t\t\tlatitude: null\n\t\t}\n\t},\n\tonShow() {\n\t\t// 页面加载时检查登录状态\n\t\tconst app = getApp();\n\t\tapp.globalData.checkLoginStatus(true); // 不强制跳转，只检查状态\n\t},\n\tonLoad() {\n\t\t// 获取当前位置\n\t\tthis.getCurrentLocation()\n\t\t\n\t\t// 页面加载时检查登录状态\n\t\tconst app = getApp();\n\t\tapp.globalData.checkLoginStatus(true); // 不强制跳转，只检查状态\n\t},\n\tmethods: {\n\t\t// 获取当前位置\n\t\tgetCurrentLocation() {\n\t\t\tuni.getLocation({\n\t\t\t\ttype: 'gcj02',\n\t\t\t\tsuccess: res => {\n\t\t\t\t\tthis.longitude = res.longitude\n\t\t\t\t\tthis.latitude = res.latitude\n\t\t\t\t\tthis.getSpotList()\n\t\t\t\t},\n\t\t\t\tfail: () => {\n\t\t\t\t\t// 获取位置失败，仍然获取景点列表，但不会有距离信息\n\t\t\t\t\tthis.getSpotList()\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\t\n\t\t// 切换分类\n\t\tchangeCategory(id) {\n\t\t\tif (this.currentCategory === id) return\n\t\t\tthis.currentCategory = id\n\t\t\tthis.page = 1\n\t\t\tthis.spotList = []\n\t\t\tthis.noMore = false\n\t\t\tthis.getSpotList()\n\t\t},\n\t\t\n\t\t// 获取景点列表\n\t\tasync getSpotList() {\n\t\t\tif (this.loading || this.noMore) return\n\t\t\tthis.loading = true\n\t\t\t\n\t\t\ttry {\n\t\t\t\tconst app = getApp();\n\t\t\t\tconst userId = app.globalData.getUserId();\n\t\t\t\t\n\t\t\t\tconst res = await uniCloud.callFunction({\n\t\t\t\t\tname: 'get-spots',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcategoryId: this.currentCategory,\n\t\t\t\t\t\tpage: this.page,\n\t\t\t\t\t\tpageSize: this.pageSize,\n\t\t\t\t\t\tlongitude: this.longitude,\n\t\t\t\t\t\tlatitude: this.latitude,\n\t\t\t\t\t\tuser_id: userId\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\tif (res.result.code === 0) {\n\t\t\t\t\tconst { list, total } = res.result.data\n\t\t\t\t\t\n\t\t\t\t\t// 处理数据\n\t\t\t\t\tconst spots = list.map(item => ({\n\t\t\t\t\t\tid: item._id,\n\t\t\t\t\t\tname: item.name,\n\t\t\t\t\t\timageUrl: item.imageUrl,\n\t\t\t\t\t\tdistance: item.distance ? Number(item.distance.toFixed(1)) : null,\n\t\t\t\t\t\ttags: item.tags || [],\n\t\t\t\t\t\trating: item.rating,\n\t\t\t\t\t\tcommentCount: item.commentCount,\n\t\t\t\t\t\tprice: item.price / 100 // 转换为元\n\t\t\t\t\t}))\n\t\t\t\t\t\n\t\t\t\t\tif (this.page === 1) {\n\t\t\t\t\t\tthis.spotList = spots\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.spotList = [...this.spotList, ...spots]\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tthis.noMore = this.spotList.length >= total\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('获取景点列表失败:', e)\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '获取景点列表失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t}\n\t\t\t\n\t\t\tthis.loading = false\n\t\t},\n\t\t\n\t\t// 下拉刷新\n\t\tasync refresh() {\n\t\t\tthis.isRefreshing = true\n\t\t\tthis.page = 1\n\t\t\tthis.spotList = []\n\t\t\tthis.noMore = false\n\t\t\tawait this.getSpotList()\n\t\t\tthis.isRefreshing = false\n\t\t},\n\t\t\n\t\t// 加载更多\n\t\tloadMore() {\n\t\t\tif (!this.noMore) {\n\t\t\t\tthis.page++\n\t\t\t\tthis.getSpotList()\n\t\t\t}\n\t\t},\n\t\t\n\t\t// 跳转到搜索页\n\t\tgoToSearch() {\n\t\t\tuni.navigateTo({\n\t\t\t\turl: '/pages/spots/search'\n\t\t\t})\n\t\t},\n\t\t\n\t\t// 跳转到详情页\n\t\tgoToDetail(id) {\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/spots/detail?id=${id}`\n\t\t\t})\n\t\t}\n\t}\n}\n</script>\n\n<style lang=\"scss\">\n.container {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100vh;\n}\n\n.search-box {\n\tpadding: 20rpx 30rpx;\n\tbackground-color: #2B9939;\n\t\n\t.search-input {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 72rpx;\n\t\tpadding: 0 30rpx;\n\t\tbackground: rgba(255, 255, 255, 0.9);\n\t\tborder-radius: 36rpx;\n\t\t\n\t\t.icon-search {\n\t\t\tfont-size: 32rpx;\n\t\t\tcolor: #666;\n\t\t\tmargin-right: 10rpx;\n\t\t}\n\t\t\n\t\t.placeholder {\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor: #999;\n\t\t}\n\t}\n}\n\n.category-scroll {\n\tbackground-color: #fff;\n\tborder-bottom: 1rpx solid #eee;\n\t\n\t.category-list {\n\t\tdisplay: flex;\n\t\tpadding: 0 20rpx;\n\t\twhite-space: nowrap;\n\t\t\n\t\t.category-item {\n\t\t\tpadding: 20rpx 30rpx;\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor: #666;\n\t\t\tposition: relative;\n\t\t\t\n\t\t\t&.active {\n\t\t\t\tcolor: #2B9939;\n\t\t\t\tfont-weight: bold;\n\t\t\t\t\n\t\t\t\t&::after {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tleft: 30rpx;\n\t\t\t\t\tright: 30rpx;\n\t\t\t\t\tbottom: 10rpx;\n\t\t\t\t\theight: 4rpx;\n\t\t\t\t\tbackground-color: #2B9939;\n\t\t\t\t\tborder-radius: 2rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n.spot-scroll {\n\tflex: 1;\n\tbackground-color: #f5f5f5;\n}\n\n.spot-list {\n\tpadding: 20rpx;\n\t\n\t.spot-item {\n\t\tmargin-bottom: 20rpx;\n\t\tbackground-color: #fff;\n\t\tborder-radius: 12rpx;\n\t\toverflow: hidden;\n\t\t\n\t\timage {\n\t\t\twidth: 100%;\n\t\t\theight: 300rpx;\n\t\t}\n\t\t\n\t\t.info {\n\t\t\tpadding: 20rpx;\n\t\t\t\n\t\t\t.name-box {\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\tmargin-bottom: 16rpx;\n\t\t\t\t\n\t\t\t\t.name {\n\t\t\t\t\tfont-size: 32rpx;\n\t\t\t\t\tcolor: #333;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.distance {\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\tcolor: #999;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.tag-list {\n\t\t\t\tmargin-bottom: 16rpx;\n\t\t\t\t\n\t\t\t\t.tag {\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\tpadding: 4rpx 12rpx;\n\t\t\t\t\tmargin-right: 12rpx;\n\t\t\t\t\tfont-size: 22rpx;\n\t\t\t\t\tcolor: #2B9939;\n\t\t\t\t\tbackground-color: rgba(43, 153, 57, 0.1);\n\t\t\t\t\tborder-radius: 4rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t.bottom {\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\t\n\t\t\t\t.rating {\n\t\t\t\t\t.score {\n\t\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\t\tcolor: #FF9500;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tmargin-right: 8rpx;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.comment {\n\t\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\t\tcolor: #999;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.price {\n\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\tcolor: #FF5B05;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n.loading, .no-more {\n\tpadding: 30rpx;\n\ttext-align: center;\n\t\n\ttext {\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n\t}\n}\n</style> ","import MiniProgramPage from 'D:/programs2024to2025/ranjiangtaoprogram/first/TravelPlatformMiniProgram/pages/spots/spots.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}