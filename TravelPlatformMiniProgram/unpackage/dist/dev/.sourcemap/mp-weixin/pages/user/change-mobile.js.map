{"version":3,"file":"change-mobile.js","sources":["pages/user/change-mobile.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9jaGFuZ2UtbW9iaWxlLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"form-box\">\r\n\t\t\t<!-- 新手机号输入 -->\r\n\t\t\t<view class=\"input-group\">\r\n\t\t\t\t<text class=\"label\">新手机号</text>\r\n\t\t\t\t<view class=\"input-box\">\r\n\t\t\t\t\t<text class=\"prefix\">+86</text>\r\n\t\t\t\t\t<input \r\n\t\t\t\t\t\ttype=\"number\" \r\n\t\t\t\t\t\tv-model=\"phone\"\r\n\t\t\t\t\t\tmaxlength=\"11\"\r\n\t\t\t\t\t\tplaceholder=\"请输入新手机号\"\r\n\t\t\t\t\t\t@input=\"checkPhone\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</view>\r\n\t\t\t\t<text class=\"error\" v-if=\"phoneError\">{{phoneError}}</text>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 验证码输入 -->\r\n\t\t\t<view class=\"input-group\">\r\n\t\t\t\t<text class=\"label\">验证码</text>\r\n\t\t\t\t<view class=\"input-box\">\r\n\t\t\t\t\t<input \r\n\t\t\t\t\t\ttype=\"number\" \r\n\t\t\t\t\t\tv-model=\"code\"\r\n\t\t\t\t\t\tmaxlength=\"6\"\r\n\t\t\t\t\t\tplaceholder=\"请输入验证码\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<button \r\n\t\t\t\t\t\tclass=\"code-btn\" \r\n\t\t\t\t\t\t:disabled=\"!canSendCode || counting\" \r\n\t\t\t\t\t\t@click=\"sendCode\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{{counting ? `${countdown}s后重发` : '获取验证码'}}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<text class=\"error\" v-if=\"codeError\">{{codeError}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 提交按钮 -->\r\n\t\t<button \r\n\t\t\tclass=\"submit-btn\" \r\n\t\t\t:class=\"{ active: canSubmit }\"\r\n\t\t\t:disabled=\"!canSubmit\"\r\n\t\t\t@click=\"changeMobile\"\r\n\t\t>\r\n\t\t\t确认修改\r\n\t\t</button>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * 更换手机号页面\r\n * @description 用户可以更换绑定的手机号\r\n */\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tphone: '',\r\n\t\t\tcode: '',\r\n\t\t\tphoneError: '',\r\n\t\t\tcodeError: '',\r\n\t\t\tcounting: false,\r\n\t\t\tcountdown: 60\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t// 是否可以发送验证码\r\n\t\tcanSendCode() {\r\n\t\t\treturn this.phone.length === 11 && !this.phoneError\r\n\t\t},\r\n\t\t// 是否可以提交\r\n\t\tcanSubmit() {\r\n\t\t\treturn this.phone.length === 11 && \r\n\t\t\t\tthis.code.length === 6 && \r\n\t\t\t\t!this.phoneError && \r\n\t\t\t\t!this.codeError\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t// 检查手机号格式\r\n\t\tcheckPhone() {\r\n\t\t\tif (this.phone.length === 11) {\r\n\t\t\t\tif (!/^1[3-9]\\d{9}$/.test(this.phone)) {\r\n\t\t\t\t\tthis.phoneError = '请输入正确的手机号'\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.phoneError = ''\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.phoneError = ''\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 发送验证码\r\n\t\tasync sendCode() {\r\n\t\t\tif (!this.canSendCode || this.counting) return\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'send-sms-code',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tphone: this.phone,\r\n\t\t\t\t\t\ttype: 'change-mobile'\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '验证码已发送',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 开始倒计时\r\n\t\t\t\t\tthis.counting = true\r\n\t\t\t\t\tthis.countdown = 60\r\n\t\t\t\t\tconst timer = setInterval(() => {\r\n\t\t\t\t\t\tthis.countdown--\r\n\t\t\t\t\t\tif (this.countdown === 0) {\r\n\t\t\t\t\t\t\tclearInterval(timer)\r\n\t\t\t\t\t\t\tthis.counting = false\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.result.message,\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('发送验证码失败:', e)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '发送失败，请重试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 更换手机号\r\n\t\tasync changeMobile() {\r\n\t\t\tif (!this.canSubmit) return\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo')\r\n\t\t\t\tif (!userInfo || !userInfo.id) {\r\n\t\t\t\t\tthrow new Error('用户未登录')\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'change-mobile',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tuserId: userInfo.id,\r\n\t\t\t\t\t\tnewMobile: this.phone,\r\n\t\t\t\t\t\tcode: this.code\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\t// 更新本地存储的用户信息\r\n\t\t\t\t\tuserInfo.mobile = this.phone\r\n\t\t\t\t\tuni.setStorageSync('userInfo', userInfo)\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '修改成功',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 返回上一页\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\t}, 1500)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(res.result.message)\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('更换手机号失败:', e)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: e.message || '修改失败，请重试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.container {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #f5f5f5;\r\n\tpadding: 40rpx;\r\n}\r\n\r\n.form-box {\r\n\tbackground-color: #fff;\r\n\tborder-radius: 12rpx;\r\n\tpadding: 20rpx;\r\n\t\r\n\t.input-group {\r\n\t\tmargin-bottom: 30rpx;\r\n\t\t\r\n\t\t.label {\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tcolor: #333;\r\n\t\t\tmargin-bottom: 20rpx;\r\n\t\t\tdisplay: block;\r\n\t\t}\r\n\t\t\r\n\t\t.input-box {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tborder-bottom: 1rpx solid #eee;\r\n\t\t\tpadding: 20rpx 0;\r\n\t\t\t\r\n\t\t\t.prefix {\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #666;\r\n\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tinput {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.code-btn {\r\n\t\t\t\twidth: 200rpx;\r\n\t\t\t\theight: 60rpx;\r\n\t\t\t\tline-height: 60rpx;\r\n\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tbackground-color: #2B9939;\r\n\t\t\t\tborder-radius: 30rpx;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\t\r\n\t\t\t\t&[disabled] {\r\n\t\t\t\t\tbackground-color: #ccc;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t&::after {\r\n\t\t\t\t\tborder: none;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t.error {\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\tcolor: #ff5b05;\r\n\t\t\tmargin-top: 10rpx;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.submit-btn {\r\n\tmargin-top: 60rpx;\r\n\theight: 88rpx;\r\n\tline-height: 88rpx;\r\n\ttext-align: center;\r\n\tbackground-color: #ccc;\r\n\tcolor: #fff;\r\n\tborder-radius: 44rpx;\r\n\tfont-size: 32rpx;\r\n\t\r\n\t&.active {\r\n\t\tbackground-color: #2B9939;\r\n\t}\r\n\t\r\n\t&::after {\r\n\t\tborder: none;\r\n\t}\r\n}\r\n</style> ","import MiniProgramPage from 'D:/programs2024to2025/ranjiangtaoprogram/first/TravelPlatformMiniProgram/pages/user/change-mobile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":"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"}