{"version":3,"file":"change-password.js","sources":["pages/user/change-password.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9jaGFuZ2UtcGFzc3dvcmQudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"form-box\">\r\n\t\t\t<!-- 旧密码输入 -->\r\n\t\t\t<view class=\"input-group\">\r\n\t\t\t\t<text class=\"label\">当前密码</text>\r\n\t\t\t\t<view class=\"input-box\">\r\n\t\t\t\t\t<input \r\n\t\t\t\t\t\t:type=\"showOldPassword ? 'text' : 'password'\"\r\n\t\t\t\t\t\tv-model=\"oldPassword\"\r\n\t\t\t\t\t\tplaceholder=\"请输入当前密码\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<text \r\n\t\t\t\t\t\tclass=\"iconfont\" \r\n\t\t\t\t\t\t:class=\"showOldPassword ? 'icon-eye' : 'icon-eye-close'\"\r\n\t\t\t\t\t\t@click=\"showOldPassword = !showOldPassword\"\r\n\t\t\t\t\t></text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 新密码输入 -->\r\n\t\t\t<view class=\"input-group\">\r\n\t\t\t\t<text class=\"label\">新密码</text>\r\n\t\t\t\t<view class=\"input-box\">\r\n\t\t\t\t\t<input \r\n\t\t\t\t\t\t:type=\"showNewPassword ? 'text' : 'password'\"\r\n\t\t\t\t\t\tv-model=\"newPassword\"\r\n\t\t\t\t\t\tplaceholder=\"请输入新密码\"\r\n\t\t\t\t\t\t@input=\"checkPassword\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<text \r\n\t\t\t\t\t\tclass=\"iconfont\" \r\n\t\t\t\t\t\t:class=\"showNewPassword ? 'icon-eye' : 'icon-eye-close'\"\r\n\t\t\t\t\t\t@click=\"showNewPassword = !showNewPassword\"\r\n\t\t\t\t\t></text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<text class=\"error\" v-if=\"passwordError\">{{passwordError}}</text>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 确认新密码 -->\r\n\t\t\t<view class=\"input-group\">\r\n\t\t\t\t<text class=\"label\">确认新密码</text>\r\n\t\t\t\t<view class=\"input-box\">\r\n\t\t\t\t\t<input \r\n\t\t\t\t\t\t:type=\"showConfirmPassword ? 'text' : 'password'\"\r\n\t\t\t\t\t\tv-model=\"confirmPassword\"\r\n\t\t\t\t\t\tplaceholder=\"请再次输入新密码\"\r\n\t\t\t\t\t\t@input=\"checkConfirmPassword\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<text \r\n\t\t\t\t\t\tclass=\"iconfont\" \r\n\t\t\t\t\t\t:class=\"showConfirmPassword ? 'icon-eye' : 'icon-eye-close'\"\r\n\t\t\t\t\t\t@click=\"showConfirmPassword = !showConfirmPassword\"\r\n\t\t\t\t\t></text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<text class=\"error\" v-if=\"confirmError\">{{confirmError}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 提交按钮 -->\r\n\t\t<button \r\n\t\t\tclass=\"submit-btn\" \r\n\t\t\t:class=\"{ active: canSubmit }\"\r\n\t\t\t:disabled=\"!canSubmit\"\r\n\t\t\t@click=\"changePassword\"\r\n\t\t>\r\n\t\t\t确认修改\r\n\t\t</button>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * 修改密码页面\r\n * @description 用户可以修改自己的登录密码\r\n */\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\toldPassword: '',\r\n\t\t\tnewPassword: '',\r\n\t\t\tconfirmPassword: '',\r\n\t\t\tshowOldPassword: false,\r\n\t\t\tshowNewPassword: false,\r\n\t\t\tshowConfirmPassword: false,\r\n\t\t\tpasswordError: '',\r\n\t\t\tconfirmError: ''\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t// 是否可以提交\r\n\t\tcanSubmit() {\r\n\t\t\treturn this.oldPassword && \r\n\t\t\t\tthis.newPassword && \r\n\t\t\t\tthis.confirmPassword && \r\n\t\t\t\t!this.passwordError && \r\n\t\t\t\t!this.confirmError\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t// 检查密码格式\r\n\t\tcheckPassword() {\r\n\t\t\tif (this.newPassword.length > 0) {\r\n\t\t\t\tif (this.newPassword.length < 6 || this.newPassword.length > 20) {\r\n\t\t\t\t\tthis.passwordError = '密码长度应为6-20位'\r\n\t\t\t\t} else if (!/^[a-zA-Z0-9_]+$/.test(this.newPassword)) {\r\n\t\t\t\t\tthis.passwordError = '密码只能包含字母、数字和下划线'\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.passwordError = ''\r\n\t\t\t\t\tthis.checkConfirmPassword()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.passwordError = ''\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 检查确认密码\r\n\t\tcheckConfirmPassword() {\r\n\t\t\tif (this.confirmPassword.length > 0) {\r\n\t\t\t\tif (this.confirmPassword !== this.newPassword) {\r\n\t\t\t\t\tthis.confirmError = '两次输入的密码不一致'\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.confirmError = ''\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.confirmError = ''\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 修改密码\r\n\t\tasync changePassword() {\r\n\t\t\tif (!this.canSubmit) return\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo')\r\n\t\t\t\tif (!userInfo || !userInfo.id) {\r\n\t\t\t\t\tthrow new Error('用户未登录')\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'change-password',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tuserId: userInfo.id,\r\n\t\t\t\t\t\toldPassword: this.oldPassword,\r\n\t\t\t\t\t\tnewPassword: this.newPassword\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '修改成功，请重新登录',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 清除登录信息\r\n\t\t\t\t\tuni.removeStorageSync('token')\r\n\t\t\t\t\tuni.removeStorageSync('userInfo')\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 返回到登录页\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\t\turl: '/pages/user/login'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 1500)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(res.result.message)\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('修改密码失败:', e)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: e.message || '修改失败，请重试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.container {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #f5f5f5;\r\n\tpadding: 40rpx;\r\n}\r\n\r\n.form-box {\r\n\tbackground-color: #fff;\r\n\tborder-radius: 12rpx;\r\n\tpadding: 20rpx;\r\n\t\r\n\t.input-group {\r\n\t\tmargin-bottom: 30rpx;\r\n\t\t\r\n\t\t.label {\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tcolor: #333;\r\n\t\t\tmargin-bottom: 20rpx;\r\n\t\t\tdisplay: block;\r\n\t\t}\r\n\t\t\r\n\t\t.input-box {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tborder-bottom: 1rpx solid #eee;\r\n\t\t\tpadding: 20rpx 0;\r\n\t\t\t\r\n\t\t\tinput {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.iconfont {\r\n\t\t\t\tfont-size: 40rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t\tpadding: 0 20rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t.error {\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\tcolor: #ff5b05;\r\n\t\t\tmargin-top: 10rpx;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.submit-btn {\r\n\tmargin-top: 60rpx;\r\n\theight: 88rpx;\r\n\tline-height: 88rpx;\r\n\ttext-align: center;\r\n\tbackground-color: #ccc;\r\n\tcolor: #fff;\r\n\tborder-radius: 44rpx;\r\n\tfont-size: 32rpx;\r\n\t\r\n\t&.active {\r\n\t\tbackground-color: #2B9939;\r\n\t}\r\n\t\r\n\t&::after {\r\n\t\tborder: none;\r\n\t}\r\n}\r\n</style> ","import MiniProgramPage from 'D:/programs2024to2025/ranjiangtaoprogram/first/TravelPlatformMiniProgram/pages/user/change-password.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AA4EA,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,aAAa;AAAA,MACb,aAAa;AAAA,MACb,iBAAiB;AAAA,MACjB,iBAAiB;AAAA,MACjB,iBAAiB;AAAA,MACjB,qBAAqB;AAAA,MACrB,eAAe;AAAA,MACf,cAAc;AAAA,IACf;AAAA,EACA;AAAA,EACD,UAAU;AAAA;AAAA,IAET,YAAY;AACX,aAAO,KAAK,eACX,KAAK,eACL,KAAK,mBACL,CAAC,KAAK,iBACN,CAAC,KAAK;AAAA,IACR;AAAA,EACA;AAAA,EACD,SAAS;AAAA;AAAA,IAER,gBAAgB;AACf,UAAI,KAAK,YAAY,SAAS,GAAG;AAChC,YAAI,KAAK,YAAY,SAAS,KAAK,KAAK,YAAY,SAAS,IAAI;AAChE,eAAK,gBAAgB;AAAA,QACpB,WAAS,CAAC,kBAAkB,KAAK,KAAK,WAAW,GAAG;AACrD,eAAK,gBAAgB;AAAA,eACf;AACN,eAAK,gBAAgB;AACrB,eAAK,qBAAqB;AAAA,QAC3B;AAAA,aACM;AACN,aAAK,gBAAgB;AAAA,MACtB;AAAA,IACA;AAAA;AAAA,IAGD,uBAAuB;AACtB,UAAI,KAAK,gBAAgB,SAAS,GAAG;AACpC,YAAI,KAAK,oBAAoB,KAAK,aAAa;AAC9C,eAAK,eAAe;AAAA,eACd;AACN,eAAK,eAAe;AAAA,QACrB;AAAA,aACM;AACN,aAAK,eAAe;AAAA,MACrB;AAAA,IACA;AAAA;AAAA,IAGD,MAAM,iBAAiB;AACtB,UAAI,CAAC,KAAK;AAAW;AAErB,UAAI;AACH,cAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC9C,YAAI,CAAC,YAAY,CAAC,SAAS,IAAI;AAC9B,gBAAM,IAAI,MAAM,OAAO;AAAA,QACxB;AAEA,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACvC,MAAM;AAAA,UACN,MAAM;AAAA,YACL,QAAQ,SAAS;AAAA,YACjB,aAAa,KAAK;AAAA,YAClB,aAAa,KAAK;AAAA,UACnB;AAAA,SACA;AAED,YAAI,IAAI,OAAO,SAAS,GAAG;AAC1BD,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,WACN;AAGDA,wBAAG,MAAC,kBAAkB,OAAO;AAC7BA,wBAAG,MAAC,kBAAkB,UAAU;AAGhC,qBAAW,MAAM;AAChBA,0BAAAA,MAAI,SAAS;AAAA,cACZ,KAAK;AAAA,aACL;AAAA,UACD,GAAE,IAAI;AAAA,eACD;AACN,gBAAM,IAAI,MAAM,IAAI,OAAO,OAAO;AAAA,QACnC;AAAA,MACD,SAAS,GAAG;AACXA,sBAAAA,MAAc,MAAA,SAAA,yCAAA,WAAW,CAAC;AAC1BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,EAAE,WAAW;AAAA,UACpB,MAAM;AAAA,SACN;AAAA,MACF;AAAA,IACD;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/KA,GAAG,WAAW,eAAe;"}