{"version":3,"file":"spot-select.js","sources":["pages/plans/spot-select.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGxhbnMvc3BvdC1zZWxlY3QudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 搜索栏 -->\r\n\t\t<view class=\"search-box\">\r\n\t\t\t<uni-search-bar\r\n\t\t\t\tv-model=\"keyword\"\r\n\t\t\t\tplaceholder=\"搜索景点\"\r\n\t\t\t\t@confirm=\"onSearch\"\r\n\t\t\t\t@clear=\"onSearch\"\r\n\t\t\t/>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"date-picker\">\r\n\t\t\t<text class=\"label\">选择游览日期</text>\r\n\t\t\t<picker \r\n\t\t\t\tmode=\"date\" \r\n\t\t\t\t:value=\"formatDate(selectedDate)\" \r\n\t\t\t\t:start=\"formatDate(startDate)\"\r\n\t\t\t\t:end=\"formatDate(endDate)\"\r\n\t\t\t\t@change=\"onDateChange\"\r\n\t\t\t>\r\n\t\t\t\t<view class=\"picker-value\">\r\n\t\t\t\t\t<text>{{ formatDate(selectedDate) || '请选择日期' }}</text>\r\n\t\t\t\t\t<uni-icons type=\"arrowright\" size=\"14\" color=\"#999999\"></uni-icons>\r\n\t\t\t\t</view>\r\n\t\t\t</picker>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 景点列表 -->\r\n\t\t<view class=\"spot-list\">\r\n\t\t\t<view v-if=\"loading\" class=\"loading\">\r\n\t\t\t\t<uni-load-more status=\"loading\"></uni-load-more>\r\n\t\t\t</view>\r\n\t\t\t<view v-else-if=\"spots.length > 0\" class=\"spot-items\">\r\n\t\t\t\t<view \r\n\t\t\t\t\tv-for=\"(item, index) in spots\" \r\n\t\t\t\t\t:key=\"item._id\" \r\n\t\t\t\t\tclass=\"spot-item\"\r\n\t\t\t\t\t@click=\"selectSpot(item)\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<image :src=\"item.imageUrl\" mode=\"aspectFill\" class=\"spot-image\"></image>\r\n\t\t\t\t\t<view class=\"spot-info\">\r\n\t\t\t\t\t\t<text class=\"spot-name\">{{item.name}}</text>\r\n\t\t\t\t\t\t<view class=\"spot-detail\">\r\n\t\t\t\t\t\t\t<text class=\"spot-rating\">{{item.rating}}分</text>\r\n\t\t\t\t\t\t\t<text class=\"spot-price\">¥{{item.price/100}}起</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<text class=\"spot-address\">{{item.address}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view v-else class=\"empty\">\r\n\t\t\t\t<text>暂无相关景点</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\t/**\r\n\t * 景点选择页面\r\n\t * @description 用于在创建/编辑旅行计划时选择景点\r\n\t */\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tkeyword: '',\r\n\t\t\t\tspots: [],\r\n\t\t\t\tloading: false,\r\n\t\t\t\tsearchTimer: null,\r\n\t\t\t\tselectedDate: '',\r\n\t\t\t\tstartDate: '',\r\n\t\t\t\tendDate: ''\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\t// 获取计划的开始日期和结束日期\r\n\t\t\tthis.startDate = parseInt(options.startDate);\r\n\t\t\tthis.endDate = parseInt(options.endDate);\r\n\t\t\t\r\n\t\t\t// 默认选择开始日期\r\n\t\t\tthis.selectedDate = this.startDate;\r\n\t\t\t\r\n\t\t\tthis.loadSpots();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 加载景点列表\r\n\t\t\t */\r\n\t\t\tasync loadSpots() {\r\n\t\t\t\tthis.loading = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\t\tname: 'get-spots',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tkeyword: this.keyword,\r\n\t\t\t\t\t\t\tpage: 1,\r\n\t\t\t\t\t\t\tpageSize: 20,\r\n\t\t\t\t\t\t\tsortBy: 'rating',\r\n\t\t\t\t\t\t\tsortOrder: 'desc'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\t\tthis.spots = res.result.data.list;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: res.result.message || '获取景点失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('获取景点失败:', e);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '获取景点失败，请稍后重试',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * 搜索输入处理\r\n\t\t\t */\r\n\t\t\tonSearch() {\r\n\t\t\t\tif (this.searchTimer) {\r\n\t\t\t\t\tclearTimeout(this.searchTimer);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.searchTimer = setTimeout(() => {\r\n\t\t\t\t\tthis.loadSpots();\r\n\t\t\t\t}, 300);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * 日期变更\r\n\t\t\t */\r\n\t\t\tonDateChange(e) {\r\n\t\t\t\tconst dateStr = e.detail.value;\r\n\t\t\t\tthis.selectedDate = new Date(dateStr).getTime();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * 选择景点\r\n\t\t\t */\r\n\t\t\tselectSpot(spot) {\r\n\t\t\t\t// 构建景点数据\r\n\t\t\t\tconst spotData = {\r\n\t\t\t\t\tspot_id: spot._id,\r\n\t\t\t\t\tvisit_date: this.selectedDate,\r\n\t\t\t\t\tnotes: '',\r\n\t\t\t\t\tspot_detail: {\r\n\t\t\t\t\t\tname: spot.name,\r\n\t\t\t\t\t\timageUrl: spot.imageUrl,\r\n\t\t\t\t\t\taddress: spot.address,\r\n\t\t\t\t\t\tprice: spot.price,\r\n\t\t\t\t\t\trating: spot.rating\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\t// 返回上一页并传递选中的景点数据\r\n\t\t\t\tconst pages = getCurrentPages();\r\n\t\t\t\tconst prevPage = pages[pages.length - 2];\r\n\t\t\t\t\r\n\t\t\t\tif (prevPage && prevPage.route === 'pages/plans/plan-edit') {\r\n\t\t\t\t\t// 调用上一页的方法添加景点\r\n\t\t\t\t\tprevPage.$vm.addSpot(spotData);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tuni.navigateBack();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * 格式化日期\r\n\t\t\t */\r\n\t\t\tformatDate(timestamp) {\r\n\t\t\t\tif (!timestamp) {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst date = new Date(timestamp);\r\n\t\t\t\treturn `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.container {\r\n\tpadding: 20rpx;\r\n\tbackground-color: #f5f5f5;\r\n\tmin-height: 100vh;\r\n}\r\n\r\n.search-box {\r\n\tbackground-color: #fff;\r\n\tpadding: 20rpx;\r\n\tborder-radius: 12rpx;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.date-picker {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tpadding: 20rpx;\r\n\tbackground-color: #FFFFFF;\r\n\tborder-radius: 8rpx;\r\n\tmargin-bottom: 20rpx;\r\n\t\r\n\t.label {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333333;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\t\r\n\t.picker-value {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333333;\r\n\t\t\r\n\t\ttext {\r\n\t\t\tmargin-right: 6rpx;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.spot-list {\r\n\t.loading {\r\n\t\tpadding: 40rpx 0;\r\n\t}\r\n\t\r\n\t.spot-items {\r\n\t\t.spot-item {\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tborder-radius: 12rpx;\r\n\t\t\tmargin-bottom: 20rpx;\r\n\t\t\toverflow: hidden;\r\n\t\t\t\r\n\t\t\t.spot-image {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 300rpx;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.spot-info {\r\n\t\t\t\tpadding: 20rpx;\r\n\t\t\t\t\r\n\t\t\t\t.spot-name {\r\n\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.spot-detail {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t\t\r\n\t\t\t\t\t.spot-rating {\r\n\t\t\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\t\t\tcolor: #FF9500;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.spot-price {\r\n\t\t\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\t\t\tcolor: #FF5B05;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.spot-address {\r\n\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\tcolor: #999;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t.empty {\r\n\t\tpadding: 100rpx 0;\r\n\t\ttext-align: center;\r\n\t\tcolor: #999;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n}\r\n</style> ","import MiniProgramPage from 'D:/programs2024to2025/ranjiangtaoprogram/first/TravelPlatformMiniProgram/pages/plans/spot-select.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":";;AA+DC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,SAAS;AAAA,MACT,OAAO,CAAE;AAAA,MACT,SAAS;AAAA,MACT,aAAa;AAAA,MACb,cAAc;AAAA,MACd,WAAW;AAAA,MACX,SAAS;AAAA,IACV;AAAA,EACA;AAAA,EACD,OAAO,SAAS;AAEf,SAAK,YAAY,SAAS,QAAQ,SAAS;AAC3C,SAAK,UAAU,SAAS,QAAQ,OAAO;AAGvC,SAAK,eAAe,KAAK;AAEzB,SAAK,UAAS;AAAA,EACd;AAAA,EACD,SAAS;AAAA;AAAA;AAAA;AAAA,IAIR,MAAM,YAAY;AACjB,WAAK,UAAU;AACf,UAAI;AACH,cAAM,MAAM,MAAMA,cAAQ,GAAC,aAAa;AAAA,UACvC,MAAM;AAAA,UACN,MAAM;AAAA,YACL,SAAS,KAAK;AAAA,YACd,MAAM;AAAA,YACN,UAAU;AAAA,YACV,QAAQ;AAAA,YACR,WAAW;AAAA,UACZ;AAAA,QACD,CAAC;AAED,YAAI,IAAI,OAAO,SAAS,GAAG;AAC1B,eAAK,QAAQ,IAAI,OAAO,KAAK;AAAA,eACvB;AACNC,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI,OAAO,WAAW;AAAA,YAC7B,MAAM;AAAA,UACP,CAAC;AAAA,QACF;AAAA,MACD,SAAS,GAAG;AACXA,sBAAc,MAAA,MAAA,SAAA,sCAAA,WAAW,CAAC;AAC1BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAC;AAAA,MACF,UAAU;AACT,aAAK,UAAU;AAAA,MAChB;AAAA,IACA;AAAA;AAAA;AAAA;AAAA,IAKD,WAAW;AACV,UAAI,KAAK,aAAa;AACrB,qBAAa,KAAK,WAAW;AAAA,MAC9B;AAEA,WAAK,cAAc,WAAW,MAAM;AACnC,aAAK,UAAS;AAAA,MACd,GAAE,GAAG;AAAA,IACN;AAAA;AAAA;AAAA;AAAA,IAKD,aAAa,GAAG;AACf,YAAM,UAAU,EAAE,OAAO;AACzB,WAAK,eAAe,IAAI,KAAK,OAAO,EAAE,QAAO;AAAA,IAC7C;AAAA;AAAA;AAAA;AAAA,IAKD,WAAW,MAAM;AAEhB,YAAM,WAAW;AAAA,QAChB,SAAS,KAAK;AAAA,QACd,YAAY,KAAK;AAAA,QACjB,OAAO;AAAA,QACP,aAAa;AAAA,UACZ,MAAM,KAAK;AAAA,UACX,UAAU,KAAK;AAAA,UACf,SAAS,KAAK;AAAA,UACd,OAAO,KAAK;AAAA,UACZ,QAAQ,KAAK;AAAA,QACd;AAAA;AAID,YAAM,QAAQ;AACd,YAAM,WAAW,MAAM,MAAM,SAAS,CAAC;AAEvC,UAAI,YAAY,SAAS,UAAU,yBAAyB;AAE3D,iBAAS,IAAI,QAAQ,QAAQ;AAAA,MAC9B;AAEAA,oBAAG,MAAC,aAAY;AAAA,IAChB;AAAA;AAAA;AAAA;AAAA,IAKD,WAAW,WAAW;AACrB,UAAI,CAAC,WAAW;AACf,eAAO;AAAA,MACR;AAEA,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,aAAO,GAAG,KAAK,YAAW,CAAE,IAAI,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI,OAAO,KAAK,SAAS,EAAE,SAAS,GAAG,GAAG,CAAC;AAAA,IACxH;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxLD,GAAG,WAAW,eAAe;"}